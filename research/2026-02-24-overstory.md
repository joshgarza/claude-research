---
date: 2026-02-24
topic: Overstory
status: complete
tags: [multi-agent, orchestration, claude-code, swarm, git-worktrees, tmux, sqlite, bun, typescript]
related: [2026-02-23-ai-agent-ticket-orchestration.md, 2026-02-23-ai-agent-linear-ticket-workflows.md]
---

# Overstory

## Context

Researched as a concrete implementation of the multi-agent orchestration patterns covered in the Feb 23 agent research sessions. Overstory is a project by Jaymin West (GitHub: jayminwest) — a project-agnostic, TypeScript/Bun CLI that turns a single Claude Code session into a multi-agent swarm. It provides everything needed to spawn, coordinate, and merge parallel Claude Code agents: git worktrees for isolation, SQLite messaging for coordination, and tiered conflict resolution for merging. It self-uses its own tool and tracks tasks in Beads.

Sources: [GitHub repo](https://github.com/jayminwest/overstory), [CLAUDE.md](https://github.com/jayminwest/overstory/blob/main/CLAUDE.md), [STEELMAN.md](https://github.com/jayminwest/overstory/blob/main/STEELMAN.md), [CHANGELOG.md](https://github.com/jayminwest/overstory/blob/main/CHANGELOG.md), [CONTRIBUTING.md](https://github.com/jayminwest/overstory/blob/main/CONTRIBUTING.md), [Addy Osmani's swarms post](https://addyosmani.com/blog/claude-code-agent-teams/), [paddo.dev hidden swarm](https://paddo.dev/blog/claude-code-hidden-swarm/), [Mulch](https://github.com/jayminwest/mulch)

---

## Findings

### Project Overview

**Overstory** (`@os-eco/overstory-cli`, v0.6.4 as of 2026-02-24) is a MIT-licensed, open-source CLI for multi-agent Claude Code orchestration. Released February 12, 2026 (v0.1.0), it has shipped 17+ versions in under 2 weeks of active development. The CLI is available as `overstory` or the shorter `ov` alias.

Key stats:
- **Runtime**: Bun ≥1.0 (TypeScript, no build step)
- **Dependencies**: Only 2 runtime deps (`chalk`, `commander`)
- **Test coverage**: 2,128 tests across 76 colocated test files
- **Linting**: Biome (format + lint combined)
- **Storage**: SQLite via `bun:sqlite` in WAL mode

The design principle is radical minimalism: zero npm imports for infrastructure. All heavy lifting (subprocess management, database, file I/O) uses Bun built-in APIs. External tools are invoked as subprocesses.

---

### Core Architecture

#### The Orchestrator Model

The central design insight: **"Your Claude Code session IS the orchestrator. There is no separate daemon."**

Sessions start when Claude Code opens a project with `.overstory/` initialized:
1. `SessionStart` hook runs `overstory prime` (loads config, activity, expertise)
2. `UserPromptSubmit` hook surfaces new messages via `overstory mail check --inject`
3. The orchestrator (human's Claude session) uses CLI commands to spawn agents, check status, and merge work

This keeps the architecture simple — the orchestrator is the human's interactive session, not a separate process.

#### Hierarchical Agent Structure

Overstory implements a three-tier hierarchy with a configurable depth limit (default: 2 levels):

```
Orchestrator (your Claude Code session, interactive)
  ↓
Supervisor / Team Lead (Claude Code in tmux, can spawn sub-workers)
  ↓
Specialist Workers (Claude Code in tmux, leaf nodes)
  → Scout (read-only: explore, research, analyze)
  → Builder (read-write: implement, modify files)
  → Reviewer (read-only: validate, code review)
  → Merger (read-write: branch integration)
```

Agent role definitions live in two layers:
- **Layer 1 (Base)**: Reusable `.md` files in `agents/` defining the HOW — workflow, constraints, capabilities. Shared across all uses of that agent type.
- **Layer 2 (Overlay)**: Per-task `CLAUDE.md` generated by `overstory sling`, defining the WHAT — task ID, file scope, spec path, branch name.

This separation keeps agent definitions reusable while making each agent's current assignment concrete and injected.

#### Tool Enforcement via Hooks

Overstory mechanically enforces role constraints using Claude Code's `PreToolUse` hooks:
- Non-implementation agents (Scout, Reviewer, Supervisor) are **blocked from file modifications** at the hook level, not the prompt level
- Dangerous git operations are blocked for all non-Merger agents
- File scope per agent is enforced via the overlay configuration

This is the correct design: **mechanical enforcement instead of prompt-based enforcement**. A Scout cannot accidentally write files even if it hallucinates instructions to do so.

#### SQLite Messaging Layer (Mail System)

Inter-agent communication goes through a purpose-built SQLite mail system at `.overstory/mail.db` (WAL mode, ~1-5ms per query).

Eight typed message categories:
- `worker_done`, `merge_ready`, `dispatch`, `escalation`
- `status`, `question`, `result`, `error`

Group addressing is supported (`@all`, `@builders`), enabling broadcasts to agent subsets.

Key CLI commands:
```bash
overstory mail send --to <agent> --subject <text> --body <text> \
  --type <status|question|result|error> --priority <low|normal|high|urgent>
overstory mail check --inject   # Surfaces unread messages into orchestrator
overstory nudge <agent>         # Direct text nudge via tmux
```

#### Merge Queue with Four-Tier Conflict Resolution

When workers complete tasks, branches are merged via a FIFO SQLite-backed queue with four escalating resolution strategies:

1. **Trivial**: Non-overlapping files — automatic, no review needed
2. **Heuristic**: Pattern-based resolution — applies known safe merge rules
3. **Semantic**: AI-assisted resolution with context — for logically related changes
4. **Manual**: Escalation to orchestrator — for genuine architectural conflicts

This mirrors the principle that most conflicts (tiers 1-2) are mechanical and should never reach a human, while preserving human judgment for the real architectural decisions.

#### Tiered Monitoring (Watchdog System)

Three monitoring layers run in parallel:
- **Tier 0 (Mechanical daemon)**: `overstory watch` — health checks, detects hung agents, restarts on crash
- **Tier 1 (AI-assisted triage)**: Analyzes error patterns and suggests fixes
- **Tier 2 (Monitor agent)**: Continuous fleet health patrol, a dedicated read-only Claude agent

---

### CLI Surface (30+ Commands)

**Core workflow:**
```bash
overstory init                     # Initialize .overstory/ in project
overstory hooks install            # Deploy orchestrator hooks
overstory coordinator start        # Start persistent orchestrator agent
overstory sling <task-id>          # Spawn worker agent
  --capability builder|scout|reviewer|lead|merger
  --name <unique-name>
  --spec <path/to/spec.md>
  --files <f1,f2,...>              # Exclusive file scope
  --depth <n>                      # Hierarchy depth (0=root)
overstory stop <agent-name>        # Terminate agent
overstory merge --branch <name>    # Merge agent branch into canonical
overstory merge --all              # Merge all agent branches
```

**Observability:**
```bash
overstory status           # Active agents and worktrees
overstory dashboard        # Live TUI monitoring
overstory inspect <agent>  # Deep agent inspection (--follow)
overstory trace <target>   # Chronological event timeline
overstory errors           # Aggregated error view
overstory replay           # Interleaved chronological replay
overstory costs            # Token/cost analysis
overstory metrics          # Session metrics
overstory doctor           # Health checks (validates: overstory, mulch, seeds, canopy)
```

**Group coordination:**
```bash
overstory group create '<name>' <id1> [id2...]
overstory group status [group-id]
overstory group add|remove <group-id> <ids...>
```

---

### Ecosystem Integration

Overstory is designed as one tool in a broader ecosystem of jayminwest's CLI tools. The `overstory doctor` command validates the presence of all ecosystem components:

- **Beads** (`bd`) / **Seeds** (`sd`): Task tracking backends. v0.6.0 introduced a `TrackerClient` abstraction layer supporting both, with auto-detection. Methods: `ready()`, `show()`, `create()`, `claim()`, `close()`, `list()`, `sync()`.
- **Mulch**: Structured expertise persistence. Agents call `mulch record` to write learnings and `mulch query` to retrieve them. Conflict patterns recorded during merges are fed back into Mulch for future sessions. See [github.com/jayminwest/mulch](https://github.com/jayminwest/mulch).
- **Canopy**: Prompt composition system. Agent definitions were restructured in v0.6.1 for Canopy prompt composition with standardized section headers. (Tool by the same author; minimal public documentation found.)

The `.overstory/` directory per project contains:
```
config.yaml           # Project configuration
agent-manifest.json   # Registry of active agents
*.db                  # SQLite databases (mail, sessions, events, metrics, merge queue)
agents/{name}/identity.yaml  # Persistent agent CV
worktrees/{name}/     # Git worktrees (gitignored)
specs/{id}.md         # Task specifications
```

---

### The Steelman Critique

Overstory is notable for shipping a `STEELMAN.md` documenting 12 serious critiques of its own architecture before encouraging production use. This is intellectually honest and practically useful.

**Top-tier critiques:**

1. **Compounding error rates**: Individual agent errors (say 5%) don't add—they compound at integration boundaries. Three agents at 95% reliability = 85.7% combined (1-(0.95³)). Integration tests catch syntax; semantic incompatibilities (wrong assumptions about sync vs async patterns, naming drift) pass tests and surface at runtime.

2. **Cost without proportional value**: 20 agents over 6 hours cost ~$60 (8M tokens). A single agent completing the same tasks sequentially: ~$9 (1.2M tokens). The 2-hour speedup cost $51 in coordination overhead. Token consumption scales with agent count; useful output doesn't.

3. **Loss of coherent reasoning**: Distributed work produces architectural drift — inconsistent naming, duplicated utilities, conflicting assumptions, impedance mismatches. These don't trigger test failures.

4. **Debugging becomes forensics**: Multi-worktree histories, distributed logs, interleaved execution timelines defeat traditional debugging. Linear cause-and-effect assumptions break across parallel branches.

5. **Expertise illusion**: The assumption that Exploration and Implementation cleanly separate is wrong. Most discoveries happen *during* implementation, requiring immediate course corrections. Swarms can't adapt mid-task without expensive coordination overhead.

6. **Operational risk**: Runaway spawning, infinite retry loops, cost multiplication — all can happen rapidly without intervention.

**When swarms actually work (per STEELMAN.md):**
- Truly independent tasks with zero shared state
- Embarrassingly parallel work (test generation, experiments, linting sweeps)
- Large-scale exploration of legacy codebases
- Research tasks that converge into a single output
- Time-critical sprints where speed justifies token costs

The overall thesis the steelman presents: **most interconnected engineering work benefits from a single focused agent maintaining coherent context.**

---

### Comparison to Competing Approaches

| Approach | Language | Coordination | Isolation | Status |
|---|---|---|---|---|
| **Overstory** | TypeScript/Bun | SQLite mail | git worktrees + tmux | Active (v0.6.4) |
| **Claude Code TeammateTool** | Built-in | Native TaskList + SendMessage | tmux panes | Feature-flagged (experimental) |
| **ccswarm** | Rust | Channel-based (Actor model) | git worktrees | Active, some features stubbed |
| **claude-flow** | TypeScript | MCP + distributed swarm | Variable | Active, enterprise-focused |
| **claude-agent-farm** | Python | Lock-based coordination | tmux | Active, simpler |
| **CCPM** | TypeScript | Flat files | git worktrees | Script-level |

**Overstory's differentiated positions:**
- Only project with mechanical hook-based role enforcement (not prompt-based)
- Most complete observability tooling (TUI dashboard, cost tracking, trace/replay)
- Only project with a formal steelman critique document shipped with the code
- Only project with purpose-built SQLite mail vs reusing generic task systems
- Highest test coverage (2,128 tests across 76 files) vs competitors with minimal testing

**Claude Code's native TeammateTool** (discovered via binary analysis of Claude Code v2.1.50) is the looming competitor: Anthropic built a complete multi-agent system into Claude Code with 13 fully-implemented TeammateTool operations and a directory structure at `~/.claude/teams/`. It's disabled behind feature flags but will likely become the default approach. Overstory's current advantage is its polish and observability layer.

---

### Design Philosophy Extracted from Source

**Zero-dependency principle**: Only `chalk` and `commander` as runtime dependencies. All infrastructure uses Bun built-ins. External tools are subprocesses, never npm imports. This keeps the tool auditable and the dependency surface minimal.

**"Never mock what you can use for real"**: Tests use actual temp directories, `:memory:` SQLite databases, real git repos in temp directories. Mocking is permitted only for tmux (interferes with developer sessions), external AI services (cost/latency), and network (CI flakiness).

**One concern per PR**: Contributing guidelines enforce single-concern PRs with mandatory tests for all new features and bug fixes.

**TypeScript strict mode**: `noUncheckedIndexedAccess`, `noExplicitAny`, all shared types in `src/types.ts`, all errors extend `OverstoryError` from `src/errors.ts`.

**SQLite WAL mode always**:
```typescript
db.exec("PRAGMA journal_mode=WAL");
db.exec("PRAGMA busy_timeout=5000");
```
Required for concurrent multi-agent access to shared databases.

---

### Practical Takeaways for This Project

The research and automation system here (this repo) has structural similarities to Overstory's design: a queue-based task system (`automation/queue.json`), hooks-driven session start, and a single orchestrator (the user's Claude session). The key differences:

- **This repo** uses JSON files for queue state vs. Overstory's SQLite — this is simpler but less concurrent-safe
- **This repo** spawns subprocesses sequentially; Overstory spawns truly parallel agents in separate tmux windows
- **This repo** has no merge phase (each research session is independent); Overstory is designed for concurrent work on shared codebases

If this automation system ever needed parallel agents (e.g., multiple research sessions running simultaneously), Overstory would be a natural adoption target. The hooks architecture would need to be adapted to coordinate the worker agent loop.

---

## Open Questions

1. **Canopy**: The prompt composition system referenced in v0.6.1 has no independent public documentation. Is it a separate jayminwest project, or internal to Overstory?
2. **Seeds** (`sd`): What is the Seeds task tracker — Beads alternative or a separate jayminwest tool? The abstraction layer implies they have different APIs.
3. **Cost ceiling**: At what project complexity does the sequential-agent cost ($9) vs. swarm cost ($60) crossover become favorable? The steelman implies this may never happen for typical engineering tasks.
4. **Native TeammateTool timeline**: When Anthropic ships Claude Code TeammateTool as a default feature, how much of Overstory's value proposition survives? The observability layer (TUI dashboard, cost tracking, trace/replay) seems durable.
5. **Mulch adoption**: Does recording to Mulch during merge conflict resolution actually improve future resolution rates? No empirical data found.

---

## Extracted Principles

Principles extracted or updated based on this research:

1. **Mechanical enforcement over prompt enforcement** — Use `PreToolUse` hooks to enforce agent role constraints, not instructions in prompts. Prompts hallucinate; hooks don't. (New principle candidate for `principles/agent-task-orchestration.md`)

2. **Ship a steelman** — Publishing genuine critiques of your own system before production adoption is a design quality signal and forces honest scoping. (Process principle, not tech)

3. **Two-layer agent instructions** — Separate the HOW (reusable base definition in a static `.md` file) from the WHAT (per-task overlay injected at spawn time). This enables reuse while keeping task assignment concrete. (Variant of existing pattern in `principles/agent-task-orchestration.md`)

4. **WAL mode is mandatory for concurrent SQLite** — Any system where multiple agents access shared SQLite databases must enable WAL mode and set a `busy_timeout`. Without WAL, concurrent writes serialize into failures. (Candidate for `principles/database-data-architecture.md`)

5. **Observability before scale** — Overstory's investment in TUI monitoring, cost tracking, trace/replay, and health checks suggests you cannot safely run a multi-agent system without real-time visibility. Build observability before adding more agents. (Reinforces existing principle in `principles/devops-infrastructure.md`)
